# Antigravity to OpenAI API ä»£ç†æœåŠ¡

å°† Google Antigravity API è½¬æ¢ä¸º OpenAI å…¼å®¹æ ¼å¼çš„ä»£ç†æœåŠ¡ï¼Œæ”¯æŒæµå¼å“åº”ã€å·¥å…·è°ƒç”¨å’Œå¤šè´¦å·ç®¡ç†ã€‚

## åŠŸèƒ½ç‰¹æ€§

- âœ… OpenAI API å…¼å®¹æ ¼å¼
- âœ… æµå¼å’Œéæµå¼å“åº”
- âœ… å·¥å…·è°ƒç”¨ï¼ˆFunction Callingï¼‰æ”¯æŒ
- âœ… å¤šè´¦å·è‡ªåŠ¨è½®æ¢ï¼ˆæ”¯æŒå¤šç§è½®è¯¢ç­–ç•¥ï¼‰
- âœ… Token è‡ªåŠ¨åˆ·æ–°
- âœ… API Key è®¤è¯
- âœ… æ€ç»´é“¾ï¼ˆThinkingï¼‰è¾“å‡ºï¼Œå…¼å®¹ OpenAI reasoning_effort å‚æ•°å’Œ DeepSeek reasoning_content æ ¼å¼
- âœ… å›¾ç‰‡è¾“å…¥æ”¯æŒï¼ˆBase64 ç¼–ç ï¼‰
- âœ… å›¾ç‰‡ç”Ÿæˆæ”¯æŒï¼ˆgemini-3-pro-image æ¨¡å‹ï¼‰
- âœ… Pro è´¦å·éšæœº ProjectId æ”¯æŒ
- âœ… æ¨¡å‹é¢åº¦æŸ¥çœ‹ï¼ˆå®æ—¶æ˜¾ç¤ºå‰©ä½™é¢åº¦å’Œé‡ç½®æ—¶é—´ï¼‰
- âœ… SD WebUI API å…¼å®¹ï¼ˆæ”¯æŒ txt2img/img2imgï¼‰
- âœ… å¿ƒè·³æœºåˆ¶ï¼ˆé˜²æ­¢ Cloudflare è¶…æ—¶æ–­è¿ï¼‰
- âœ… æ¨¡å‹åˆ—è¡¨ç¼“å­˜ï¼ˆå‡å°‘ API è¯·æ±‚ï¼‰
- âœ… èµ„æ ¼æ ¡éªŒè‡ªåŠ¨å›é€€ï¼ˆæ— èµ„æ ¼æ—¶è‡ªåŠ¨ç”Ÿæˆéšæœº ProjectIdï¼‰
- âœ… çœŸ System æ¶ˆæ¯åˆå¹¶ï¼ˆå¼€å¤´è¿ç»­å¤šæ¡ system ä¸ SystemInstruction åˆå¹¶ï¼‰
- âœ… éšç§æ¨¡å¼ï¼ˆè‡ªåŠ¨éšè—æ•æ„Ÿä¿¡æ¯ï¼‰
- âœ… å†…å­˜ä¼˜åŒ–ï¼ˆä» 8+ è¿›ç¨‹å‡å°‘ä¸º 2 ä¸ªè¿›ç¨‹ï¼Œå†…å­˜å ç”¨ä» 100MB+ é™ä¸º 50MB+ï¼‰
- âœ… å¯¹è±¡æ± å¤ç”¨ï¼ˆå‡å°‘ 50%+ ä¸´æ—¶å¯¹è±¡åˆ›å»ºï¼Œé™ä½ GC é¢‘ç‡ï¼‰
- âœ… ç­¾åé€ä¼ æ§åˆ¶ï¼ˆå¯é…ç½®æ˜¯å¦å°† thoughtSignature é€ä¼ åˆ°å®¢æˆ·ç«¯ï¼‰
- âœ… é¢„ç¼–è¯‘äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆæ”¯æŒ Windows/Linux/Androidï¼Œæ— éœ€ Node.js ç¯å¢ƒï¼‰
- âœ… å¤š API æ ¼å¼æ”¯æŒï¼ˆOpenAIã€Geminiã€Claude ä¸‰ç§æ ¼å¼ï¼‰
- âœ… è½¬æ¢å™¨ä»£ç å¤ç”¨ï¼ˆå…¬å…±æ¨¡å—æå–ï¼Œå‡å°‘é‡å¤ä»£ç ï¼‰
- âœ… åŠ¨æ€å†…å­˜é˜ˆå€¼ï¼ˆæ ¹æ®ç”¨æˆ·é…ç½®è‡ªåŠ¨è®¡ç®—å„çº§åˆ«é˜ˆå€¼ï¼‰

## ç¯å¢ƒè¦æ±‚

- Node.js >= 18.0.0

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
npm install
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ `.env.example` ä¸º `.env` å¹¶ç¼–è¾‘é…ç½®ï¼š

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶é…ç½®å¿…è¦å‚æ•°ï¼š

```env
# å¿…å¡«é…ç½®
API_KEY=sk-text
ADMIN_USERNAME=admin
ADMIN_PASSWORD=admin123
JWT_SECRET=your-jwt-secret-key-change-this-in-production

# å¯é€‰é…ç½®
# PROXY=http://127.0.0.1:7890
# SYSTEM_INSTRUCTION=ä½ æ˜¯èŠå¤©æœºå™¨äºº
# IMAGE_BASE_URL=http://your-domain.com
```

### 3. ç™»å½•è·å– Token

```bash
npm run login
```

æµè§ˆå™¨ä¼šè‡ªåŠ¨æ‰“å¼€ Google æˆæƒé¡µé¢ï¼Œæˆæƒå Token ä¼šä¿å­˜åˆ° `data/accounts.json`ã€‚

### 4. å¯åŠ¨æœåŠ¡

```bash
npm start
```

æœåŠ¡å°†åœ¨ `http://localhost:8045` å¯åŠ¨ã€‚

## äºŒè¿›åˆ¶æ–‡ä»¶éƒ¨ç½²ï¼ˆæ¨èï¼‰

æ— éœ€å®‰è£… Node.jsï¼Œç›´æ¥ä¸‹è½½é¢„ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶å³å¯è¿è¡Œã€‚

### ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶

ä» [GitHub Releases](https://github.com/ZhaoShanGeng/antigravity2api-nodejs/releases) ä¸‹è½½å¯¹åº”å¹³å°çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼š

| å¹³å° | æ–‡ä»¶å |
|------|--------|
| Windows x64 | `antigravity2api-win-x64.exe` |
| Linux x64 | `antigravity2api-linux-x64` |
| Linux ARM64 | `antigravity2api-linux-arm64` |
| macOS x64 | `antigravity2api-macos-x64` |
| macOS ARM64 | `antigravity2api-macos-arm64` |

### å‡†å¤‡é…ç½®æ–‡ä»¶

å°†ä»¥ä¸‹æ–‡ä»¶æ”¾åœ¨äºŒè¿›åˆ¶æ–‡ä»¶åŒç›®å½•ä¸‹ï¼š

```
â”œâ”€â”€ antigravity2api-win-x64.exe  # äºŒè¿›åˆ¶æ–‡ä»¶
â”œâ”€â”€ .env                          # ç¯å¢ƒå˜é‡é…ç½®ï¼ˆå¿…éœ€ï¼‰
â”œâ”€â”€ config.json                   # åŸºç¡€é…ç½®ï¼ˆå¿…éœ€ï¼‰
â”œâ”€â”€ public/                       # é™æ€æ–‡ä»¶ç›®å½•ï¼ˆå¿…éœ€ï¼‰
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ style.css
â”‚   â”œâ”€â”€ assets/
â”‚   â”‚   â””â”€â”€ bg.jpg
â”‚   â””â”€â”€ js/
â”‚       â”œâ”€â”€ auth.js
â”‚       â”œâ”€â”€ config.js
â”‚       â”œâ”€â”€ main.js
â”‚       â”œâ”€â”€ quota.js
â”‚       â”œâ”€â”€ tokens.js
â”‚       â”œâ”€â”€ ui.js
â”‚       â””â”€â”€ utils.js
â””â”€â”€ data/                         # æ•°æ®ç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
    â””â”€â”€ accounts.json
```

### é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```env
API_KEY=sk-your-api-key
ADMIN_USERNAME=admin
ADMIN_PASSWORD=admin123
JWT_SECRET=your-jwt-secret-key-change-this-in-production
# IMAGE_BASE_URL=http://your-domain.com
# PROXY=http://127.0.0.1:7890
```

### è¿è¡Œ

**Windows**ï¼š
```bash
# ç›´æ¥åŒå‡»è¿è¡Œï¼Œæˆ–åœ¨å‘½ä»¤è¡Œæ‰§è¡Œ
antigravity2api-win-x64.exe
```

**Linux/macOS**ï¼š
```bash
# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x antigravity2api-linux-x64

# è¿è¡Œ
./antigravity2api-linux-x64
```

### äºŒè¿›åˆ¶éƒ¨ç½²è¯´æ˜

- **æ— éœ€ Node.js**ï¼šäºŒè¿›åˆ¶æ–‡ä»¶å·²åŒ…å« Node.js è¿è¡Œæ—¶
- **é…ç½®æ–‡ä»¶**ï¼š`.env` å’Œ `config.json` å¿…é¡»ä¸äºŒè¿›åˆ¶æ–‡ä»¶åœ¨åŒä¸€ç›®å½•
- **é™æ€æ–‡ä»¶**ï¼š`public/` ç›®å½•å¿…é¡»ä¸äºŒè¿›åˆ¶æ–‡ä»¶åœ¨åŒä¸€ç›®å½•
- **æ•°æ®æŒä¹…åŒ–**ï¼š`data/` ç›®å½•ä¼šè‡ªåŠ¨åˆ›å»ºï¼Œç”¨äºå­˜å‚¨ Token æ•°æ®
- **è·¨å¹³å°**ï¼šæ”¯æŒ Windowsã€Linuxã€macOSï¼ˆx64 å’Œ ARM64ï¼‰

### ä½œä¸ºç³»ç»ŸæœåŠ¡è¿è¡Œï¼ˆLinuxï¼‰

åˆ›å»º systemd æœåŠ¡æ–‡ä»¶ `/etc/systemd/system/antigravity2api.service`ï¼š

```ini
[Unit]
Description=Antigravity2API Service
After=network.target

[Service]
Type=simple
User=www-data
WorkingDirectory=/opt/antigravity2api
ExecStart=/opt/antigravity2api/antigravity2api-linux-x64
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

å¯åŠ¨æœåŠ¡ï¼š

```bash
sudo systemctl daemon-reload
sudo systemctl enable antigravity2api
sudo systemctl start antigravity2api
```

## Docker éƒ¨ç½²

### ä½¿ç”¨ Docker Composeï¼ˆæ¨èï¼‰

1. **é…ç½®ç¯å¢ƒå˜é‡**

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶é…ç½®å¿…è¦å‚æ•°ã€‚

2. **å¯åŠ¨æœåŠ¡**

```bash
docker-compose up -d
```

3. **æŸ¥çœ‹æ—¥å¿—**

```bash
docker-compose logs -f
```

4. **åœæ­¢æœåŠ¡**

```bash
docker-compose down
```

### ä½¿ç”¨ Docker

1. **æ„å»ºé•œåƒ**

```bash
docker build -t antigravity2api .
```

2. **è¿è¡Œå®¹å™¨**

```bash
docker run -d \
  --name antigravity2api \
  -p 8045:8045 \
  -e API_KEY=sk-text \
  -e ADMIN_USERNAME=admin \
  -e ADMIN_PASSWORD=admin123 \
  -e JWT_SECRET=your-jwt-secret-key \
  -e IMAGE_BASE_URL=http://your-domain.com \
  -v $(pwd)/data:/app/data \
  -v $(pwd)/public/images:/app/public/images \
  -v $(pwd)/.env:/app/.env \
  -v $(pwd)/config.json:/app/config.json \
  antigravity2api
```

3. **æŸ¥çœ‹æ—¥å¿—**

```bash
docker logs -f antigravity2api
```

### Docker éƒ¨ç½²è¯´æ˜

- æ•°æ®æŒä¹…åŒ–ï¼š`data/` ç›®å½•æŒ‚è½½åˆ°å®¹å™¨ï¼Œä¿å­˜ Token æ•°æ®
- å›¾ç‰‡å­˜å‚¨ï¼š`public/images/` ç›®å½•æŒ‚è½½åˆ°å®¹å™¨ï¼Œä¿å­˜ç”Ÿæˆçš„å›¾ç‰‡
- é…ç½®æ–‡ä»¶ï¼š`.env` å’Œ `config.json` æŒ‚è½½åˆ°å®¹å™¨ï¼Œæ”¯æŒçƒ­æ›´æ–°
- ç«¯å£æ˜ å°„ï¼šé»˜è®¤æ˜ å°„ 8045 ç«¯å£ï¼Œå¯æ ¹æ®éœ€è¦ä¿®æ”¹
- è‡ªåŠ¨é‡å¯ï¼šå®¹å™¨å¼‚å¸¸é€€å‡ºä¼šè‡ªåŠ¨é‡å¯

## Zeabur éƒ¨ç½²

### ä½¿ç”¨é¢„æ„å»ºé•œåƒéƒ¨ç½²

1. **åˆ›å»ºæœåŠ¡**

åœ¨ Zeabur æ§åˆ¶å°åˆ›å»ºæ–°æœåŠ¡ï¼Œä½¿ç”¨ä»¥ä¸‹é•œåƒï¼š

```
ghcr.io/liuw1535/antigravity2api-nodejs
```

2. **é…ç½®ç¯å¢ƒå˜é‡**

åœ¨æœåŠ¡è®¾ç½®ä¸­æ·»åŠ ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

| ç¯å¢ƒå˜é‡ | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|--------|
| `API_KEY` | API è®¤è¯å¯†é’¥ | `sk-your-api-key` |
| `ADMIN_USERNAME` | ç®¡ç†å‘˜ç”¨æˆ·å | `admin` |
| `ADMIN_PASSWORD` | ç®¡ç†å‘˜å¯†ç  | `your-secure-password` |
| `JWT_SECRET` | JWT å¯†é’¥ | `your-jwt-secret-key` |
| `IMAGE_BASE_URL` | å›¾ç‰‡æœåŠ¡åŸºç¡€ URL | `https://your-domain.zeabur.app` |

å¯é€‰ç¯å¢ƒå˜é‡ï¼š
- `PROXY`ï¼šä»£ç†åœ°å€
- `SYSTEM_INSTRUCTION`ï¼šç³»ç»Ÿæç¤ºè¯

3. **é…ç½®æŒä¹…åŒ–å­˜å‚¨**

åœ¨æœåŠ¡çš„ã€ŒVolumesã€è®¾ç½®ä¸­æ·»åŠ ä»¥ä¸‹æŒ‚è½½ç‚¹ï¼š

| æŒ‚è½½è·¯å¾„ | è¯´æ˜ |
|---------|------|
| `/app/data` | Token æ•°æ®å­˜å‚¨ |
| `/app/public/images` | ç”Ÿæˆçš„å›¾ç‰‡å­˜å‚¨ |

âš ï¸ **é‡è¦æç¤º**ï¼š
- åªæŒ‚è½½ `/app/data` å’Œ `/app/public/images` è¿™ä¸¤ä¸ªç›®å½•
- ä¸è¦æŒ‚è½½å…¶ä»–ç›®å½•ï¼ˆå¦‚ `/app/.env`ã€`/app/config.json` ç­‰ï¼‰ï¼Œå¦åˆ™ä¼šå¯¼è‡´å¿…è¦é…ç½®æ–‡ä»¶è¢«æ¸…ç©ºï¼Œé¡¹ç›®æ— æ³•å¯åŠ¨

4. **ç»‘å®šåŸŸå**

åœ¨æœåŠ¡çš„ã€ŒNetworkingã€è®¾ç½®ä¸­ç»‘å®šåŸŸåï¼Œç„¶åå°†è¯¥åŸŸåè®¾ç½®åˆ° `IMAGE_BASE_URL` ç¯å¢ƒå˜é‡ä¸­ã€‚

5. **å¯åŠ¨æœåŠ¡**

ä¿å­˜é…ç½®åï¼ŒZeabur ä¼šè‡ªåŠ¨æ‹‰å–é•œåƒå¹¶å¯åŠ¨æœåŠ¡ã€‚è®¿é—®ç»‘å®šçš„åŸŸåå³å¯ä½¿ç”¨ã€‚

### Zeabur éƒ¨ç½²è¯´æ˜

- ä½¿ç”¨é¢„æ„å»ºçš„ Docker é•œåƒï¼Œæ— éœ€æ‰‹åŠ¨æ„å»º
- é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®æ‰€æœ‰å¿…è¦å‚æ•°
- æŒä¹…åŒ–å­˜å‚¨ç¡®ä¿ Token å’Œå›¾ç‰‡æ•°æ®ä¸ä¸¢å¤±

## Web ç®¡ç†ç•Œé¢

æœåŠ¡å¯åŠ¨åï¼Œè®¿é—® `http://localhost:8045` å³å¯æ‰“å¼€ Web ç®¡ç†ç•Œé¢ã€‚

### åŠŸèƒ½ç‰¹æ€§

- ğŸ” **å®‰å…¨ç™»å½•**ï¼šJWT Token è®¤è¯ï¼Œä¿æŠ¤ç®¡ç†æ¥å£
- ğŸ“Š **å®æ—¶ç»Ÿè®¡**ï¼šæ˜¾ç¤ºæ€» Token æ•°ã€å¯ç”¨/ç¦ç”¨çŠ¶æ€ç»Ÿè®¡
- â• **å¤šç§æ·»åŠ æ–¹å¼**ï¼š
  - OAuth æˆæƒç™»å½•ï¼ˆæ¨èï¼‰ï¼šè‡ªåŠ¨å®Œæˆ Google æˆæƒæµç¨‹
  - æ‰‹åŠ¨å¡«å…¥ï¼šç›´æ¥è¾“å…¥ Access Token å’Œ Refresh Token
- ğŸ¯ **Token ç®¡ç†**ï¼š
  - æŸ¥çœ‹æ‰€æœ‰ Token çš„è¯¦ç»†ä¿¡æ¯ï¼ˆAccess Token åç¼€ã€Project IDã€è¿‡æœŸæ—¶é—´ï¼‰
  - ğŸ“Š æŸ¥çœ‹æ¨¡å‹é¢åº¦ï¼šæŒ‰ç±»å‹åˆ†ç»„æ˜¾ç¤ºï¼ˆClaude/Gemini/å…¶ä»–ï¼‰ï¼Œå®æ—¶æŸ¥çœ‹å‰©ä½™é¢åº¦å’Œé‡ç½®æ—¶é—´
  - ä¸€é”®å¯ç”¨/ç¦ç”¨ Token
  - åˆ é™¤æ— æ•ˆ Token
  - å®æ—¶åˆ·æ–° Token åˆ—è¡¨
- âš™ï¸ **é…ç½®ç®¡ç†**ï¼š
  - åœ¨çº¿ç¼–è¾‘æœåŠ¡å™¨é…ç½®ï¼ˆç«¯å£ã€ç›‘å¬åœ°å€ï¼‰
  - è°ƒæ•´é»˜è®¤å‚æ•°ï¼ˆæ¸©åº¦ã€Top P/Kã€æœ€å¤§ Token æ•°ï¼‰
  - ä¿®æ”¹å®‰å…¨é…ç½®ï¼ˆAPI å¯†é’¥ã€è¯·æ±‚å¤§å°é™åˆ¶ï¼‰
  - é…ç½®ä»£ç†ã€ç³»ç»Ÿæç¤ºè¯ç­‰å¯é€‰é¡¹
  - çƒ­é‡è½½é…ç½®ï¼ˆéƒ¨åˆ†é…ç½®éœ€é‡å¯ç”Ÿæ•ˆï¼‰

### ä½¿ç”¨æµç¨‹

1. **ç™»å½•ç³»ç»Ÿ**
   - ä½¿ç”¨ `.env` ä¸­é…ç½®çš„ `ADMIN_USERNAME` å’Œ `ADMIN_PASSWORD` ç™»å½•
   - ç™»å½•æˆåŠŸåä¼šè‡ªåŠ¨ä¿å­˜ JWT Token åˆ°æµè§ˆå™¨

2. **æ·»åŠ  Token**
   - **OAuth æ–¹å¼**ï¼ˆæ¨èï¼‰ï¼š
     1. ç‚¹å‡»ã€ŒOAuthç™»å½•ã€æŒ‰é’®
     2. åœ¨å¼¹çª—ä¸­ç‚¹å‡»ã€Œæ‰“å¼€æˆæƒé¡µé¢ã€
     3. åœ¨æ–°çª—å£å®Œæˆ Google æˆæƒ
     4. å¤åˆ¶æµè§ˆå™¨åœ°å€æ çš„å®Œæ•´å›è°ƒ URL
     5. ç²˜è´´åˆ°è¾“å…¥æ¡†å¹¶æäº¤
   - **æ‰‹åŠ¨æ–¹å¼**ï¼š
     1. ç‚¹å‡»ã€Œæ‰‹åŠ¨å¡«å…¥ã€æŒ‰é’®
     2. å¡«å†™ Access Tokenã€Refresh Token å’Œè¿‡æœŸæ—¶é—´
     3. æäº¤ä¿å­˜

3. **ç®¡ç† Token**
   - æŸ¥çœ‹ Token å¡ç‰‡æ˜¾ç¤ºçš„çŠ¶æ€å’Œä¿¡æ¯
   - ç‚¹å‡»ã€ŒğŸ“Š æŸ¥çœ‹é¢åº¦ã€æŒ‰é’®æŸ¥çœ‹è¯¥è´¦å·çš„æ¨¡å‹é¢åº¦ä¿¡æ¯
     - è‡ªåŠ¨æŒ‰æ¨¡å‹ç±»å‹åˆ†ç»„ï¼ˆClaude/Gemini/å…¶ä»–ï¼‰
     - æ˜¾ç¤ºå‰©ä½™é¢åº¦ç™¾åˆ†æ¯”å’Œè¿›åº¦æ¡
     - æ˜¾ç¤ºé¢åº¦é‡ç½®æ—¶é—´ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
     - æ”¯æŒã€Œç«‹å³åˆ·æ–°ã€å¼ºåˆ¶æ›´æ–°é¢åº¦æ•°æ®
   - ä½¿ç”¨ã€Œå¯ç”¨/ç¦ç”¨ã€æŒ‰é’®æ§åˆ¶ Token çŠ¶æ€
   - ä½¿ç”¨ã€Œåˆ é™¤ã€æŒ‰é’®ç§»é™¤æ— æ•ˆ Token
   - ç‚¹å‡»ã€Œåˆ·æ–°ã€æŒ‰é’®æ›´æ–°åˆ—è¡¨

4. **éšç§æ¨¡å¼**
   - é»˜è®¤å¼€å¯ï¼Œè‡ªåŠ¨éšè— Tokenã€Project ID ç­‰æ•æ„Ÿä¿¡æ¯
   - ç‚¹å‡»ã€Œæ˜¾ç¤ºæ•æ„Ÿä¿¡æ¯ã€åˆ‡æ¢æ˜¾ç¤º/éšè—çŠ¶æ€
   - æ”¯æŒé€ä¸ªæŸ¥çœ‹æˆ–æ‰¹é‡æ˜¾ç¤º

5. **é…ç½®è½®è¯¢ç­–ç•¥**
   - æ”¯æŒä¸‰ç§è½®è¯¢ç­–ç•¥ï¼š
     - `round_robin`ï¼šå‡è¡¡è´Ÿè½½ï¼Œæ¯æ¬¡è¯·æ±‚åˆ‡æ¢ Token
     - `quota_exhausted`ï¼šé¢åº¦è€—å°½æ‰åˆ‡æ¢
     - `request_count`ï¼šè‡ªå®šä¹‰è¯·æ±‚æ¬¡æ•°ååˆ‡æ¢
   - å¯åœ¨ã€Œè®¾ç½®ã€é¡µé¢é…ç½®

6. **ä¿®æ”¹é…ç½®**
   - åˆ‡æ¢åˆ°ã€Œè®¾ç½®ã€æ ‡ç­¾é¡µ
   - ä¿®æ”¹éœ€è¦è°ƒæ•´çš„é…ç½®é¡¹
   - ç‚¹å‡»ã€Œä¿å­˜é…ç½®ã€æŒ‰é’®åº”ç”¨æ›´æ”¹
   - æ³¨æ„ï¼šç«¯å£å’Œç›‘å¬åœ°å€ä¿®æ”¹éœ€è¦é‡å¯æœåŠ¡
   - æ”¯æŒçš„è®¾ç½®é¡¹ï¼š
     - ç¼–è¾‘ Token ä¿¡æ¯ï¼ˆAccess Tokenã€Refresh Tokenï¼‰
     - æ€è€ƒé¢„ç®—ï¼ˆ1024-32000ï¼‰
     - å›¾ç‰‡è®¿é—®åœ°å€
     - è½®è¯¢ç­–ç•¥
     - å†…å­˜é˜ˆå€¼
     - å¿ƒè·³é—´éš”
     - å­—ä½“å¤§å°

### ç•Œé¢é¢„è§ˆ

- **Token ç®¡ç†é¡µé¢**ï¼šå¡ç‰‡å¼å±•ç¤ºæ‰€æœ‰ Tokenï¼Œæ”¯æŒå¿«é€Ÿæ“ä½œ
- **è®¾ç½®é¡µé¢**ï¼šåˆ†ç±»å±•ç¤ºæ‰€æœ‰é…ç½®é¡¹ï¼Œæ”¯æŒåœ¨çº¿ç¼–è¾‘
- **å“åº”å¼è®¾è®¡**ï¼šæ”¯æŒæ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡è®¿é—®
- **å­—ä½“ä¼˜åŒ–**ï¼šé‡‡ç”¨ MiSans + Ubuntu Mono å­—ä½“ï¼Œå¢å¼ºå¯è¯»æ€§

## API ä½¿ç”¨

æœåŠ¡æä¾› OpenAI å…¼å®¹çš„ API æ¥å£ï¼Œè¯¦ç»†ä½¿ç”¨è¯´æ˜è¯·æŸ¥çœ‹ [API.md](API.md)ã€‚

### å¿«é€Ÿæµ‹è¯•

```bash
curl http://localhost:8045/v1/chat/completions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer sk-text" \
  -d '{
    "model": "gemini-2.0-flash-exp",
    "messages": [{"role": "user", "content": "ä½ å¥½"}]
  }'
```

## å¤šè´¦å·ç®¡ç†

`data/accounts.json` æ”¯æŒå¤šä¸ªè´¦å·ï¼ŒæœåŠ¡ä¼šè‡ªåŠ¨è½®æ¢ä½¿ç”¨ï¼š

```json
[
  {
    "access_token": "ya29.xxx",
    "refresh_token": "1//xxx",
    "expires_in": 3599,
    "timestamp": 1234567890000,
    "enable": true
  },
  {
    "access_token": "ya29.yyy",
    "refresh_token": "1//yyy",
    "expires_in": 3599,
    "timestamp": 1234567890000,
    "enable": true
  }
]
```

- `enable: false` å¯ç¦ç”¨æŸä¸ªè´¦å·
- Token è¿‡æœŸä¼šè‡ªåŠ¨åˆ·æ–°
- åˆ·æ–°å¤±è´¥ï¼ˆ403ï¼‰ä¼šè‡ªåŠ¨ç¦ç”¨å¹¶åˆ‡æ¢ä¸‹ä¸€ä¸ªè´¦å·

## é…ç½®è¯´æ˜

é¡¹ç›®é…ç½®åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š

### 1. config.jsonï¼ˆåŸºç¡€é…ç½®ï¼‰

åŸºç¡€é…ç½®æ–‡ä»¶ï¼ŒåŒ…å«æœåŠ¡å™¨ã€API å’Œé»˜è®¤å‚æ•°è®¾ç½®ï¼š

```json
{
  "server": {
    "port": 8045,              // æœåŠ¡ç«¯å£
    "host": "0.0.0.0",         // ç›‘å¬åœ°å€
    "maxRequestSize": "500mb", // æœ€å¤§è¯·æ±‚ä½“å¤§å°
    "heartbeatInterval": 15000,// å¿ƒè·³é—´éš”ï¼ˆæ¯«ç§’ï¼‰ï¼Œé˜²æ­¢ Cloudflare è¶…æ—¶
    "memoryThreshold": 100     // å†…å­˜é˜ˆå€¼ï¼ˆMBï¼‰ï¼Œè¶…è¿‡æ—¶è§¦å‘ GC
  },
  "rotation": {
    "strategy": "round_robin", // è½®è¯¢ç­–ç•¥ï¼šround_robin/quota_exhausted/request_count
    "requestCount": 50         // request_count ç­–ç•¥ä¸‹æ¯ä¸ª Token çš„è¯·æ±‚æ¬¡æ•°
  },
  "defaults": {
    "temperature": 1,          // é»˜è®¤æ¸©åº¦å‚æ•°
    "topP": 1,                 // é»˜è®¤ top_p
    "topK": 50,                // é»˜è®¤ top_k
    "maxTokens": 32000,        // é»˜è®¤æœ€å¤§ token æ•°
    "thinkingBudget": 1024     // é»˜è®¤æ€è€ƒé¢„ç®—ï¼ˆä»…å¯¹æ€è€ƒæ¨¡å‹ç”Ÿæ•ˆï¼ŒèŒƒå›´ 1024-32000ï¼‰
  },
  "cache": {
    "modelListTTL": 3600000    // æ¨¡å‹åˆ—è¡¨ç¼“å­˜æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œé»˜è®¤ 1 å°æ—¶
  },
  "other": {
    "timeout": 300000,         // è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
    "skipProjectIdFetch": false,// è·³è¿‡ ProjectId è·å–ï¼Œç›´æ¥éšæœºç”Ÿæˆï¼ˆä»… Pro è´¦å·æœ‰æ•ˆï¼‰
    "useNativeAxios": false,   // ä½¿ç”¨åŸç”Ÿ axios è€Œé AntigravityRequester
    "useContextSystemPrompt": false, // æ˜¯å¦å°†è¯·æ±‚ä¸­çš„ system æ¶ˆæ¯åˆå¹¶åˆ° SystemInstruction
    "passSignatureToClient": false   // æ˜¯å¦å°† thoughtSignature é€ä¼ åˆ°å®¢æˆ·ç«¯
  }
}
```

### è½®è¯¢ç­–ç•¥è¯´æ˜

| ç­–ç•¥ | è¯´æ˜ |
|------|------|
| `round_robin` | å‡è¡¡è´Ÿè½½ï¼šæ¯æ¬¡è¯·æ±‚ååˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ª Token |
| `quota_exhausted` | é¢åº¦è€—å°½æ‰åˆ‡æ¢ï¼šæŒç»­ä½¿ç”¨å½“å‰ Token ç›´åˆ°é¢åº¦ç”¨å®Œï¼ˆé«˜æ€§èƒ½ä¼˜åŒ–ï¼‰ |
| `request_count` | è‡ªå®šä¹‰æ¬¡æ•°ï¼šæ¯ä¸ª Token ä½¿ç”¨æŒ‡å®šæ¬¡æ•°ååˆ‡æ¢ï¼ˆé»˜è®¤ç­–ç•¥ï¼‰ |

### 2. .envï¼ˆæ•æ„Ÿé…ç½®ï¼‰

ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶ï¼ŒåŒ…å«æ•æ„Ÿä¿¡æ¯å’Œå¯é€‰é…ç½®ï¼š

| ç¯å¢ƒå˜é‡ | è¯´æ˜ | å¿…å¡« |
|--------|------|------|
| `API_KEY` | API è®¤è¯å¯†é’¥ | âœ… |
| `ADMIN_USERNAME` | ç®¡ç†å‘˜ç”¨æˆ·å | âœ… |
| `ADMIN_PASSWORD` | ç®¡ç†å‘˜å¯†ç  | âœ… |
| `JWT_SECRET` | JWT å¯†é’¥ | âœ… |
| `PROXY` | ä»£ç†åœ°å€ï¼ˆå¦‚ï¼šhttp://127.0.0.1:7890ï¼‰ï¼Œä¹Ÿæ”¯æŒç³»ç»Ÿä»£ç†ç¯å¢ƒå˜é‡ 
|`HTTP_PROXY`/`HTTPS_PROXY` | âŒ |
| `SYSTEM_INSTRUCTION` | ç³»ç»Ÿæç¤ºè¯ | âŒ |
| `IMAGE_BASE_URL` | å›¾ç‰‡æœåŠ¡åŸºç¡€ URL | âŒ |

å®Œæ•´é…ç½®ç¤ºä¾‹è¯·å‚è€ƒ `.env.example` æ–‡ä»¶ã€‚

## å¼€å‘å‘½ä»¤

```bash
# å¯åŠ¨æœåŠ¡
npm start

# å¼€å‘æ¨¡å¼ï¼ˆè‡ªåŠ¨é‡å¯ï¼‰
npm run dev

# ç™»å½•è·å– Token
npm run login
```

## é¡¹ç›®ç»“æ„

```
.
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ accounts.json       # Token å­˜å‚¨ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”‚   â””â”€â”€ quotas.json         # é¢åº¦ç¼“å­˜ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ index.html          # Web ç®¡ç†ç•Œé¢
â”‚   â”œâ”€â”€ app.js              # å‰ç«¯é€»è¾‘
â”‚   â”œâ”€â”€ style.css           # ç•Œé¢æ ·å¼
â”‚   â””â”€â”€ images/             # ç”Ÿæˆçš„å›¾ç‰‡å­˜å‚¨ç›®å½•
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ oauth-server.js     # OAuth ç™»å½•æœåŠ¡
â”‚   â””â”€â”€ refresh-tokens.js   # Token åˆ·æ–°è„šæœ¬
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ client.js       # API è°ƒç”¨é€»è¾‘ï¼ˆå«æ¨¡å‹åˆ—è¡¨ç¼“å­˜ï¼‰
â”‚   â”‚   â””â”€â”€ stream_parser.js # æµå¼å“åº”è§£æï¼ˆå¯¹è±¡æ± ä¼˜åŒ–ï¼‰
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ jwt.js          # JWT è®¤è¯
â”‚   â”‚   â”œâ”€â”€ token_manager.js # Token ç®¡ç†ï¼ˆå«è½®è¯¢ç­–ç•¥ï¼‰
â”‚   â”‚   â”œâ”€â”€ token_store.js  # Token æ–‡ä»¶å­˜å‚¨ï¼ˆå¼‚æ­¥è¯»å†™ï¼‰
â”‚   â”‚   â””â”€â”€ quota_manager.js # é¢åº¦ç¼“å­˜ç®¡ç†
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ admin.js        # ç®¡ç†æ¥å£è·¯ç”±
â”‚   â”‚   â””â”€â”€ sd.js           # SD WebUI å…¼å®¹æ¥å£
â”‚   â”œâ”€â”€ bin/
â”‚   â”‚   â”œâ”€â”€ antigravity_requester_android_arm64   # Android ARM64 TLS è¯·æ±‚å™¨
â”‚   â”‚   â”œâ”€â”€ antigravity_requester_linux_amd64     # Linux AMD64 TLS è¯·æ±‚å™¨
â”‚   â”‚   â””â”€â”€ antigravity_requester_windows_amd64.exe # Windows AMD64 TLS è¯·æ±‚å™¨
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ config.js       # é…ç½®åŠ è½½
â”‚   â”‚   â””â”€â”€ init-env.js     # ç¯å¢ƒå˜é‡åˆå§‹åŒ–
â”‚   â”œâ”€â”€ constants/
â”‚   â”‚   â”œâ”€â”€ index.js        # åº”ç”¨å¸¸é‡å®šä¹‰
â”‚   â”‚   â””â”€â”€ oauth.js        # OAuth å¸¸é‡
â”‚   â”œâ”€â”€ server/
â”‚   â”‚   â””â”€â”€ index.js        # ä¸»æœåŠ¡å™¨ï¼ˆå«å†…å­˜ç®¡ç†å’Œå¿ƒè·³ï¼‰
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ configReloader.js # é…ç½®çƒ­é‡è½½
â”‚   â”‚   â”œâ”€â”€ deepMerge.js    # æ·±åº¦åˆå¹¶å·¥å…·
â”‚   â”‚   â”œâ”€â”€ envParser.js    # ç¯å¢ƒå˜é‡è§£æ
â”‚   â”‚   â”œâ”€â”€ errors.js       # ç»Ÿä¸€é”™è¯¯å¤„ç†
â”‚   â”‚   â”œâ”€â”€ idGenerator.js  # ID ç”Ÿæˆå™¨
â”‚   â”‚   â”œâ”€â”€ imageStorage.js # å›¾ç‰‡å­˜å‚¨
â”‚   â”‚   â”œâ”€â”€ logger.js       # æ—¥å¿—æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ memoryManager.js # æ™ºèƒ½å†…å­˜ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ parameterNormalizer.js # ç»Ÿä¸€å‚æ•°å¤„ç†
â”‚   â”‚   â”œâ”€â”€ paths.js        # è·¯å¾„å·¥å…·ï¼ˆæ”¯æŒ pkg æ‰“åŒ…ï¼‰
â”‚   â”‚   â”œâ”€â”€ thoughtSignatureCache.js # ç­¾åç¼“å­˜
â”‚   â”‚   â”œâ”€â”€ toolConverter.js # å·¥å…·å®šä¹‰è½¬æ¢
â”‚   â”‚   â”œâ”€â”€ toolNameCache.js # å·¥å…·åç§°ç¼“å­˜
â”‚   â”‚   â””â”€â”€ utils.js        # å·¥å…·å‡½æ•°ï¼ˆé‡å¯¼å‡ºï¼‰
â”‚   â”‚   â””â”€â”€ converters/     # æ ¼å¼è½¬æ¢å™¨
â”‚   â”‚       â”œâ”€â”€ common.js   # å…¬å…±å‡½æ•°
â”‚   â”‚       â”œâ”€â”€ openai.js   # OpenAI æ ¼å¼
â”‚   â”‚       â”œâ”€â”€ claude.js   # Claude æ ¼å¼
â”‚   â”‚       â””â”€â”€ gemini.js   # Gemini æ ¼å¼
â”‚   â””â”€â”€ AntigravityRequester.js # TLS æŒ‡çº¹è¯·æ±‚å™¨å°è£…
â”œâ”€â”€ test/
â”‚   â”œâ”€â”€ test-request.js     # è¯·æ±‚æµ‹è¯•
â”‚   â”œâ”€â”€ test-image-generation.js # å›¾ç‰‡ç”Ÿæˆæµ‹è¯•
â”‚   â”œâ”€â”€ test-token-rotation.js # Token è½®æ¢æµ‹è¯•
â”‚   â””â”€â”€ test-transform.js   # è½¬æ¢æµ‹è¯•
â”œâ”€â”€ .env                    # ç¯å¢ƒå˜é‡é…ç½®ï¼ˆæ•æ„Ÿä¿¡æ¯ï¼‰
â”œâ”€â”€ .env.example            # ç¯å¢ƒå˜é‡é…ç½®ç¤ºä¾‹
â”œâ”€â”€ config.json             # åŸºç¡€é…ç½®æ–‡ä»¶
â”œâ”€â”€ Dockerfile              # Docker æ„å»ºæ–‡ä»¶
â”œâ”€â”€ docker-compose.yml      # Docker Compose é…ç½®
â””â”€â”€ package.json            # é¡¹ç›®é…ç½®
```

## Pro è´¦å·éšæœº ProjectId

å¯¹äº Pro è®¢é˜…è´¦å·ï¼Œå¯ä»¥è·³è¿‡ API éªŒè¯ç›´æ¥ä½¿ç”¨éšæœºç”Ÿæˆçš„ ProjectIdï¼š

1. åœ¨ `config.json` æ–‡ä»¶ä¸­è®¾ç½®ï¼š
```json
{
  "other": {
    "skipProjectIdFetch": true
  }
}
```

2. è¿è¡Œ `npm run login` ç™»å½•æ—¶ä¼šè‡ªåŠ¨ä½¿ç”¨éšæœºç”Ÿæˆçš„ ProjectId

3. å·²æœ‰è´¦å·ä¹Ÿä¼šåœ¨ä½¿ç”¨æ—¶è‡ªåŠ¨ç”Ÿæˆéšæœº ProjectId

æ³¨æ„ï¼šæ­¤åŠŸèƒ½ä»…é€‚ç”¨äº Pro è®¢é˜…è´¦å·ã€‚å®˜æ–¹å·²ä¿®å¤å…è´¹è´¦å·ä½¿ç”¨éšæœº ProjectId çš„æ¼æ´ã€‚

## èµ„æ ¼æ ¡éªŒè‡ªåŠ¨å›é€€

å½“ OAuth ç™»å½•æˆ–æ·»åŠ  Token æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹è´¦å·çš„è®¢é˜…èµ„æ ¼ï¼š

1. **æœ‰èµ„æ ¼çš„è´¦å·**ï¼šæ­£å¸¸ä½¿ç”¨ API è¿”å›çš„ ProjectId
2. **æ— èµ„æ ¼çš„è´¦å·**ï¼šè‡ªåŠ¨ç”Ÿæˆéšæœº ProjectIdï¼Œé¿å…æ·»åŠ å¤±è´¥

è¿™ä¸€æœºåˆ¶ç¡®ä¿äº†ï¼š
- æ— è®ºè´¦å·æ˜¯å¦æœ‰ Pro è®¢é˜…ï¼Œéƒ½èƒ½æˆåŠŸæ·»åŠ  Token
- è‡ªåŠ¨é™çº§å¤„ç†ï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„
- ä¸ä¼šå› ä¸ºèµ„æ ¼æ ¡éªŒå¤±è´¥è€Œé˜»æ­¢ç™»å½•æµç¨‹

## çœŸ System æ¶ˆæ¯åˆå¹¶

æœ¬æœåŠ¡æ”¯æŒå°†å¼€å¤´è¿ç»­çš„å¤šæ¡ system æ¶ˆæ¯ä¸å…¨å±€ SystemInstruction åˆå¹¶ï¼š

```
è¯·æ±‚æ¶ˆæ¯ï¼š
[system] ä½ æ˜¯åŠ©æ‰‹
[system] è¯·ä½¿ç”¨ä¸­æ–‡å›ç­”
[user] ä½ å¥½

åˆå¹¶åï¼š
SystemInstruction = å…¨å±€é…ç½®çš„ç³»ç»Ÿæç¤ºè¯ + "\n\n" + "ä½ æ˜¯åŠ©æ‰‹\n\nè¯·ä½¿ç”¨ä¸­æ–‡å›ç­”"
messages = [{role: user, content: ä½ å¥½}]
```

è¿™ä¸€è®¾è®¡ï¼š
- å…¼å®¹ OpenAI çš„å¤š system æ¶ˆæ¯æ ¼å¼
- å……åˆ†åˆ©ç”¨ Antigravity çš„ SystemInstruction åŠŸèƒ½
- ç¡®ä¿ç³»ç»Ÿæç¤ºè¯çš„å®Œæ•´æ€§å’Œä¼˜å…ˆçº§

## å¤š API æ ¼å¼æ”¯æŒ

æœ¬æœåŠ¡æ”¯æŒä¸‰ç§ API æ ¼å¼ï¼Œæ¯ç§æ ¼å¼éƒ½æœ‰å®Œæ•´çš„å‚æ•°æ”¯æŒï¼š

### OpenAI æ ¼å¼ (`/v1/chat/completions`)

```json
{
  "model": "gemini-2.0-flash-thinking-exp",
  "max_tokens": 16000,
  "temperature": 0.7,
  "top_p": 0.9,
  "top_k": 40,
  "thinking_budget": 10000,
  "reasoning_effort": "high",
  "messages": [...]
}
```

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `max_tokens` | æœ€å¤§è¾“å‡º token æ•° | 32000 |
| `temperature` | æ¸©åº¦ (0.0-1.0) | 1 |
| `top_p` | Top-P é‡‡æ · | 1 |
| `top_k` | Top-K é‡‡æ · | 50 |
| `thinking_budget` | æ€è€ƒé¢„ç®— (1024-32000) | 1024 |
| `reasoning_effort` | æ€è€ƒå¼ºåº¦ (`low`/`medium`/`high`) | - |

### Claude æ ¼å¼ (`/v1/messages`)

```json
{
  "model": "claude-sonnet-4-5-thinking",
  "max_tokens": 16000,
  "temperature": 0.7,
  "top_p": 0.9,
  "top_k": 40,
  "thinking": {
    "type": "enabled",
    "budget_tokens": 10000
  },
  "messages": [...]
}
```

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `max_tokens` | æœ€å¤§è¾“å‡º token æ•° | 32000 |
| `temperature` | æ¸©åº¦ (0.0-1.0) | 1 |
| `top_p` | Top-P é‡‡æ · | 1 |
| `top_k` | Top-K é‡‡æ · | 50 |
| `thinking.type` | æ€è€ƒå¼€å…³ (`enabled`/`disabled`) | - |
| `thinking.budget_tokens` | æ€è€ƒé¢„ç®— (1024-32000) | 1024 |

### Gemini æ ¼å¼ (`/v1beta/models/:model:generateContent`)

```json
{
  "contents": [...],
  "generationConfig": {
    "maxOutputTokens": 16000,
    "temperature": 0.7,
    "topP": 0.9,
    "topK": 40,
    "thinkingConfig": {
      "includeThoughts": true,
      "thinkingBudget": 10000
    }
  }
}
```

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `maxOutputTokens` | æœ€å¤§è¾“å‡º token æ•° | 32000 |
| `temperature` | æ¸©åº¦ (0.0-1.0) | 1 |
| `topP` | Top-P é‡‡æ · | 1 |
| `topK` | Top-K é‡‡æ · | 50 |
| `thinkingConfig.includeThoughts` | æ˜¯å¦åŒ…å«æ€è€ƒå†…å®¹ | true |
| `thinkingConfig.thinkingBudget` | æ€è€ƒé¢„ç®— (1024-32000) | 1024 |

### ç»Ÿä¸€å‚æ•°å¤„ç†

æ‰€æœ‰ä¸‰ç§æ ¼å¼çš„å‚æ•°éƒ½ä¼šè¢«ç»Ÿä¸€è§„èŒƒåŒ–å¤„ç†ï¼Œç¡®ä¿ä¸€è‡´çš„è¡Œä¸ºï¼š

1. **å‚æ•°ä¼˜å…ˆçº§**ï¼šè¯·æ±‚å‚æ•° > é…ç½®æ–‡ä»¶é»˜è®¤å€¼
2. **æ€è€ƒé¢„ç®—ä¼˜å…ˆçº§**ï¼š`thinking_budget`/`budget_tokens`/`thinkingBudget` > `reasoning_effort` > é…ç½®æ–‡ä»¶é»˜è®¤å€¼
3. **ç¦ç”¨æ€è€ƒ**ï¼šè®¾ç½® `thinking_budget=0` æˆ– `thinking.type="disabled"` æˆ– `thinkingConfig.includeThoughts=false`

### DeepSeek æ€è€ƒæ ¼å¼å…¼å®¹

æœ¬æœåŠ¡è‡ªåŠ¨é€‚é… DeepSeek çš„ `reasoning_content` æ ¼å¼ï¼Œå°†æ€ç»´é“¾å†…å®¹å•ç‹¬è¾“å‡ºï¼Œé¿å…ä¸æ­£å¸¸å†…å®¹æ··æ·†ï¼š

```json
{
  "choices": [{
    "message": {
      "content": "æœ€ç»ˆç­”æ¡ˆ",
      "reasoning_content": "è¿™æ˜¯æ€è€ƒè¿‡ç¨‹..."
    }
  }]
}
```

### reasoning_effort æ˜ å°„

| å€¼ | æ€è€ƒ Token é¢„ç®— |
|---|----------------|
| `low` | 1024 |
| `medium` | 16000 |
| `high` | 32000 |

## å†…å­˜ä¼˜åŒ–

æœ¬æœåŠ¡ç»è¿‡æ·±åº¦å†…å­˜ä¼˜åŒ–ï¼š

### ä¼˜åŒ–æ•ˆæœ

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å |
|------|--------|--------|
| è¿›ç¨‹æ•° | 8+ | 2 |
| å†…å­˜å ç”¨ | 100MB+ | 50MB+ |
| GC é¢‘ç‡ | é«˜ | ä½ |

### ä¼˜åŒ–æ‰‹æ®µ

1. **å¯¹è±¡æ± å¤ç”¨**ï¼šæµå¼å“åº”å¯¹è±¡é€šè¿‡å¯¹è±¡æ± å¤ç”¨ï¼Œå‡å°‘ 50%+ ä¸´æ—¶å¯¹è±¡åˆ›å»º
2. **é¢„ç¼–è¯‘å¸¸é‡**ï¼šæ­£åˆ™è¡¨è¾¾å¼ã€æ ¼å¼å­—ç¬¦ä¸²ç­‰é¢„ç¼–è¯‘ï¼Œé¿å…é‡å¤åˆ›å»º
3. **LineBuffer ä¼˜åŒ–**ï¼šé«˜æ•ˆçš„æµå¼è¡Œåˆ†å‰²ï¼Œé¿å…é¢‘ç¹å­—ç¬¦ä¸²æ“ä½œ
4. **è‡ªåŠ¨å†…å­˜æ¸…ç†**ï¼šå †å†…å­˜è¶…è¿‡é˜ˆå€¼æ—¶è‡ªåŠ¨è§¦å‘ GC
5. **è¿›ç¨‹ç²¾ç®€**ï¼šç§»é™¤ä¸å¿…è¦çš„å­è¿›ç¨‹ï¼Œç»Ÿä¸€åœ¨ä¸»è¿›ç¨‹å¤„ç†

### åŠ¨æ€å†…å­˜é˜ˆå€¼

å†…å­˜å‹åŠ›é˜ˆå€¼æ ¹æ®ç”¨æˆ·é…ç½®çš„ `memoryThreshold`ï¼ˆMBï¼‰åŠ¨æ€è®¡ç®—ï¼š

| å‹åŠ›çº§åˆ« | é˜ˆå€¼æ¯”ä¾‹ | é»˜è®¤å€¼ï¼ˆ100MB é…ç½®ï¼‰ | è¡Œä¸º |
|---------|---------|---------------------|------|
| LOW | 30% | 30MB | æ­£å¸¸è¿è¡Œ |
| MEDIUM | 60% | 60MB | è½»åº¦æ¸…ç† |
| HIGH | 100% | 100MB | ç§¯ææ¸…ç† + GC |
| CRITICAL | >100% | >100MB | ç´§æ€¥æ¸…ç† + å¼ºåˆ¶ GC |

### é…ç½®

```json
{
  "server": {
    "memoryThreshold": 100
  }
}
```

- `memoryThreshold`ï¼šé«˜å‹åŠ›é˜ˆå€¼ï¼ˆMBï¼‰ï¼Œå…¶ä»–çº§åˆ«æŒ‰æ¯”ä¾‹è‡ªåŠ¨è®¡ç®—

## å¿ƒè·³æœºåˆ¶

ä¸ºé˜²æ­¢ Cloudflare ç­‰ CDN å› é•¿æ—¶é—´æ— å“åº”è€Œæ–­å¼€è¿æ¥ï¼Œæœ¬æœåŠ¡å®ç°äº† SSE å¿ƒè·³æœºåˆ¶ï¼š

- åœ¨æµå¼å“åº”æœŸé—´ï¼Œå®šæœŸå‘é€å¿ƒè·³åŒ…ï¼ˆ`: heartbeat\n\n`ï¼‰
- é»˜è®¤é—´éš” 15 ç§’ï¼Œå¯é…ç½®
- å¿ƒè·³åŒ…ç¬¦åˆ SSE è§„èŒƒï¼Œå®¢æˆ·ç«¯ä¼šè‡ªåŠ¨å¿½ç•¥

### é…ç½®

```json
{
  "server": {
    "heartbeatInterval": 15000
  }
}
```

- `heartbeatInterval`ï¼šå¿ƒè·³é—´éš”ï¼ˆæ¯«ç§’ï¼‰ï¼Œè®¾ä¸º 0 ç¦ç”¨å¿ƒè·³

## ä»£ç æ¶æ„

### è½¬æ¢å™¨æ¨¡å—

é¡¹ç›®æ”¯æŒä¸‰ç§ API æ ¼å¼ï¼ˆOpenAIã€Geminiã€Claudeï¼‰ï¼Œè½¬æ¢å™¨ä»£ç ç»è¿‡ä¼˜åŒ–ï¼Œæå–äº†å…¬å…±æ¨¡å—ï¼š

```
src/utils/converters/
â”œâ”€â”€ common.js      # å…¬å…±å‡½æ•°ï¼ˆç­¾åå¤„ç†ã€æ¶ˆæ¯æ„å»ºã€è¯·æ±‚ä½“æ„å»ºç­‰ï¼‰
â”œâ”€â”€ openai.js      # OpenAI æ ¼å¼è½¬æ¢å™¨
â”œâ”€â”€ claude.js      # Claude æ ¼å¼è½¬æ¢å™¨
â””â”€â”€ gemini.js      # Gemini æ ¼å¼è½¬æ¢å™¨
```

#### å…¬å…±å‡½æ•°

| å‡½æ•° | è¯´æ˜ |
|------|------|
| `getSignatureContext()` | è·å–æ€ç»´ç­¾åå’Œå·¥å…·ç­¾å |
| `pushUserMessage()` | æ·»åŠ ç”¨æˆ·æ¶ˆæ¯åˆ°æ¶ˆæ¯æ•°ç»„ |
| `findFunctionNameById()` | æ ¹æ®å·¥å…·è°ƒç”¨ ID æŸ¥æ‰¾å‡½æ•°å |
| `pushFunctionResponse()` | æ·»åŠ å‡½æ•°å“åº”åˆ°æ¶ˆæ¯æ•°ç»„ |
| `createThoughtPart()` | åˆ›å»ºå¸¦ç­¾åçš„æ€ç»´ part |
| `createFunctionCallPart()` | åˆ›å»ºå¸¦ç­¾åçš„å‡½æ•°è°ƒç”¨ part |
| `processToolName()` | å¤„ç†å·¥å…·åç§°æ˜ å°„ |
| `pushModelMessage()` | æ·»åŠ æ¨¡å‹æ¶ˆæ¯åˆ°æ¶ˆæ¯æ•°ç»„ |
| `buildRequestBody()` | æ„å»º Antigravity è¯·æ±‚ä½“ |
| `mergeSystemInstruction()` | åˆå¹¶ç³»ç»ŸæŒ‡ä»¤ |

### å‚æ•°è§„èŒƒåŒ–æ¨¡å—

```
src/utils/parameterNormalizer.js  # ç»Ÿä¸€å‚æ•°å¤„ç†
```

å°† OpenAIã€Claudeã€Gemini ä¸‰ç§æ ¼å¼çš„å‚æ•°ç»Ÿä¸€è½¬æ¢ä¸ºå†…éƒ¨æ ¼å¼ï¼š

| å‡½æ•° | è¯´æ˜ |
|------|------|
| `normalizeOpenAIParameters()` | è§„èŒƒåŒ– OpenAI æ ¼å¼å‚æ•° |
| `normalizeClaudeParameters()` | è§„èŒƒåŒ– Claude æ ¼å¼å‚æ•° |
| `normalizeGeminiParameters()` | è§„èŒƒåŒ– Gemini æ ¼å¼å‚æ•° |
| `toGenerationConfig()` | è½¬æ¢ä¸ºä¸Šæ¸¸ API æ ¼å¼ |

### å·¥å…·è½¬æ¢æ¨¡å—

```
src/utils/toolConverter.js  # ç»Ÿä¸€çš„å·¥å…·å®šä¹‰è½¬æ¢
```

æ”¯æŒå°† OpenAIã€Claudeã€Gemini ä¸‰ç§æ ¼å¼çš„å·¥å…·å®šä¹‰è½¬æ¢ä¸º Antigravity æ ¼å¼ã€‚

## æ³¨æ„äº‹é¡¹

1. é¦–æ¬¡ä½¿ç”¨éœ€è¦å¤åˆ¶ `.env.example` ä¸º `.env` å¹¶é…ç½®
2. è¿è¡Œ `npm run login` è·å– Token
3. `.env` å’Œ `data/accounts.json` åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œè¯·å‹¿æ³„éœ²
4. æ”¯æŒå¤šè´¦å·è½®æ¢ï¼Œæé«˜å¯ç”¨æ€§
5. Token ä¼šè‡ªåŠ¨åˆ·æ–°ï¼Œæ— éœ€æ‰‹åŠ¨ç»´æŠ¤

## License

MIT
